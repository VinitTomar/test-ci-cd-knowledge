name: For main branch

on: 
  push:
    branches:
      - 'main'

jobs:
  Validate:
    uses: ./.github/workflows/validate.yml
  Deploy:
    needs: Validate
    runs-on: ubuntu-latest
    environment: prod
    steps:
      - uses: actions/checkout@v2
      - uses: akhileshns/heroku-deploy@v3.12.12
        with:
          heroku_api_key: ${{ secrets.HEROKU_API_KEY }}
          heroku_app_name: ${{ secrets.HEROKU_APP_NAME }}
          heroku_email: ${{ secrets.HEROKU_EMAIL_ID }}
    # - name: Login to Heroku Container registry. 
    #   env: 
    #     HEROKU_API_KEY: ${{ secrets.HEROKU_API_KEY }}
    #   run: heroku container:login
    # - name: Build and push
    #   env:
    #     HEROKU_API_KEY: ${{ secrets.HEROKU_API_KEY }}
    #   run: |
    #     npm install
    #     npm run build
    #     heroku container:push -a ${{ secrets.HEROKU_APP_NAME }} web 
    # - name: Release
    #   env:
    #     HEROKU_API_KEY: ${{ secrets.HEROKU_API_KEY }}
    #   run: heroku container:release -a ${{ secrets.HEROKU_APP_NAME }} web
    
